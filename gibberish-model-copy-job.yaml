apiVersion: batch/v1
kind: Job
metadata:
  name: copy-inetuned-model
  namespace: z-grid
spec:
  template:
    spec:
      restartPolicy: OnFailure
      containers:
      - name: model-copier
        image: python:3.11-slim
        command: ["/bin/bash", "-c"]
        args:
        - |
          set -e
          echo "üöÄ Setting up Inetuned Gibbrish Model files..."

          # Install git to clone the model files
          apt-get update && apt-get install -y git curl

          # Clone the repository with model files
          echo "üì• Cloning model files..."
          cd /tmp
          git clone https://github.com/microsoft/AKSDemo.git temp-repo || {
            echo "üîÑ Using alternative approach - creating model structure..."
            mkdir -p /model_volume/inetuned_gibbrish_model
          }

          # Create the model directory structure
          echo "üìÅ Creating model directory structure..."
          mkdir -p /model_volume/inetuned_gibbrish_model

          # Create basic model config files (this is a placeholder - in real deployment you'd copy the actual model)
          cat << 'EOF' > /model_volume/inetuned_gibbrish_model/config.json
          {
            "architectures": ["BertForSequenceClassification"],
            "model_type": "bert",
            "num_labels": 2,
            "id2label": {"0": "clean", "1": "gibberish"},
            "label2id": {"clean": 0, "gibberish": 1}
          }
          EOF

          cat << 'EOF' > /model_volume/inetuned_gibbrish_model/tokenizer_config.json
          {
            "do_lower_case": true,
            "model_max_length": 512,
            "padding_side": "right",
            "truncation_side": "right"
          }
          EOF

          # Create a simple tokenizer vocab (placeholder)
          cat << 'EOF' > /model_volume/inetuned_gibbrish_model/vocab.txt
          [PAD]
          [UNK]
          [CLS]
          [SEP]
          [MASK]
          the
          quick
          brown
          fox
          jumps
          over
          lazy
          dog
          EOF

          echo "‚úÖ Model setup completed"
          echo "üìä Model files ready at: /model_volume/inetuned_gibbrish_model"
          ls -la /model_volume/inetuned_gibbrish_model/
        volumeMounts:
        - name: model-volume
          mountPath: /model_volume
      volumes:
      - name: model-volume
        persistentVolumeClaim:
          claimName: gibberish-model-pvc