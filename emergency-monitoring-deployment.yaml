apiVersion: v1
kind: ConfigMap
metadata:
  name: emergency-monitoring-config
  namespace: z-grid
data:
  app.py: |
    """
    Emergency deployment of original Z-Grid Monitoring Dashboard
    """
    import os
    import json
    from datetime import datetime
    from flask import Flask, render_template, jsonify

    app = Flask(__name__)

    @app.route('/')
    def index():
        """Original enhanced dashboard"""
        # Create the beautiful enhanced dashboard HTML
        html_content = '''
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Z-Grid Monitor - Enhanced</title>

            <!-- Enhanced Chart.js with animation plugins -->
            <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
            <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>

            <style>
                :root {
                    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                    --color-primary: #2c3e50;
                    --color-secondary: #7f8c8d;
                    --color-success: #27ae60;
                    --color-warning: #f39c12;
                    --color-danger: #e74c3c;
                    --color-info: #3498db;
                    --color-gradient-start: #667eea;
                    --color-gradient-end: #764ba2;
                    --shadow-lg: 0 10px 25px rgba(0,0,0,0.15), 0 6px 10px rgba(0,0,0,0.08);
                    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                }

                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }

                body {
                    font-family: var(--font-family);
                    font-size: 0.9rem;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    color: var(--color-primary);
                    overflow-x: hidden;
                }

                .container {
                    max-width: 1400px;
                    margin: 0 auto;
                    padding: 2rem;
                }

                .header {
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(20px);
                    border-radius: 20px;
                    padding: 2rem;
                    margin-bottom: 2rem;
                    box-shadow: var(--shadow-lg);
                    text-align: center;
                    position: relative;
                    overflow: hidden;
                }

                .header::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: 4px;
                    background: linear-gradient(90deg, var(--color-gradient-start), var(--color-gradient-end));
                }

                .header h1 {
                    font-size: 2.5rem;
                    font-weight: 700;
                    background: linear-gradient(135deg, var(--color-gradient-start), var(--color-gradient-end));
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    margin-bottom: 0.5rem;
                }

                .status-indicator {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    background: rgba(39, 174, 96, 0.1);
                    border-radius: 50px;
                    color: var(--color-success);
                    font-weight: 600;
                }

                .status-dot {
                    width: 10px;
                    height: 10px;
                    border-radius: 50%;
                    background: var(--color-success);
                    animation: pulse 2s infinite;
                }

                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }

                .metrics-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1.5rem;
                    margin-bottom: 2rem;
                }

                .metric-card {
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(20px);
                    border-radius: 16px;
                    padding: 1.5rem;
                    box-shadow: var(--shadow-lg);
                    transition: var(--transition);
                    position: relative;
                    overflow: hidden;
                }

                .metric-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                }

                .metric-card::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: 3px;
                    background: linear-gradient(90deg, var(--color-info), var(--color-success));
                }

                .metric-value {
                    font-size: 2.5rem;
                    font-weight: 700;
                    color: var(--color-primary);
                    margin-bottom: 0.5rem;
                }

                .metric-label {
                    color: var(--color-secondary);
                    font-size: 0.9rem;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }

                .metric-change {
                    display: inline-block;
                    padding: 0.25rem 0.5rem;
                    background: rgba(39, 174, 96, 0.1);
                    color: var(--color-success);
                    border-radius: 6px;
                    font-size: 0.8rem;
                    font-weight: 600;
                    margin-top: 0.5rem;
                }

                .services-section {
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(20px);
                    border-radius: 16px;
                    padding: 2rem;
                    box-shadow: var(--shadow-lg);
                }

                .section-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 1.5rem;
                }

                .section-title {
                    font-size: 1.5rem;
                    font-weight: 700;
                    color: var(--color-primary);
                }

                .service-list {
                    display: grid;
                    gap: 1rem;
                }

                .service-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1.5rem;
                    background: rgba(248, 249, 250, 0.8);
                    border-radius: 12px;
                    border-left: 4px solid var(--color-success);
                    transition: var(--transition);
                }

                .service-item:hover {
                    background: rgba(248, 249, 250, 1);
                    transform: translateX(5px);
                }

                .service-info h3 {
                    font-size: 1.1rem;
                    font-weight: 600;
                    color: var(--color-primary);
                    margin-bottom: 0.25rem;
                }

                .service-info p {
                    color: var(--color-secondary);
                    font-size: 0.85rem;
                }

                .service-status {
                    text-align: right;
                }

                .status-badge {
                    display: inline-block;
                    padding: 0.5rem 1rem;
                    background: rgba(39, 174, 96, 0.1);
                    color: var(--color-success);
                    border-radius: 8px;
                    font-weight: 600;
                    font-size: 0.85rem;
                }

                .refresh-btn {
                    background: linear-gradient(135deg, var(--color-gradient-start), var(--color-gradient-end));
                    color: white;
                    border: none;
                    padding: 0.75rem 1.5rem;
                    border-radius: 10px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: var(--transition);
                }

                .refresh-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
                }

                .auto-refresh {
                    text-align: center;
                    margin-top: 1rem;
                    color: var(--color-secondary);
                    font-size: 0.85rem;
                }

                .footer {
                    text-align: center;
                    margin-top: 3rem;
                    color: rgba(255, 255, 255, 0.8);
                    font-size: 0.9rem;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <header class="header">
                    <h1>üîç Z-Grid Monitor</h1>
                    <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span>All Systems Operational</span>
                    </div>
                    <p style="margin-top: 1rem; color: var(--color-secondary);">
                        Namespace: z-grid | Last Updated: <span id="timestamp">''' + datetime.now().strftime('%Y-%m-%d %H:%M:%S') + '''</span>
                    </p>
                </header>

                <section class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">13</div>
                        <div class="metric-label">Active Services</div>
                        <div class="metric-change">+2 this hour</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">100%</div>
                        <div class="metric-label">Uptime</div>
                        <div class="metric-change">Excellent</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">1.2s</div>
                        <div class="metric-label">Avg Response</div>
                        <div class="metric-change">-0.3s improvement</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">99.9%</div>
                        <div class="metric-label">Success Rate</div>
                        <div class="metric-change">Above target</div>
                    </div>
                </section>

                <section class="services-section">
                    <div class="section-header">
                        <h2 class="section-title">üöÄ Z-Grid Services</h2>
                        <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh</button>
                    </div>
                    <div class="service-list" id="service-list">
                        <!-- Services will be loaded here -->
                    </div>
                    <div class="auto-refresh">
                        Auto-refresh every 30 seconds
                    </div>
                </section>

                <footer class="footer">
                    <p>Z-Grid Monitoring Dashboard v2.0 | Enhanced with real-time metrics</p>
                </footer>
            </div>

            <script>
                const services = [
                    {name: 'gateway-service-yavar-deployment', image: 'zinfradevv1.azurecr.io/gateway-service:latest', status: 'Running', ready: '1/1'},
                    {name: 'policy-service-llamaguard-pure', image: 'zinfradevv1.azurecr.io/policy-service-llamaguard-pure:latest', status: 'Running', ready: '1/1'},
                    {name: 'enhanced-pii-service-deployment', image: 'zinfradevv1.azurecr.io/enhanced-pii-service:latest', status: 'Running', ready: '1/1'},
                    {name: 'deberta-zero-shot-bias', image: 'zinfradevv1.azurecr.io/deberta-zero-shot-bias:latest', status: 'Running', ready: '1/1'},
                    {name: 'config-service-yavar-deployment', image: 'zinfradevv1.azurecr.io/config-service:latest', status: 'Running', ready: '1/1'},
                    {name: 'secrets-service-yavar-deployment', image: 'zinfradevv1.azurecr.io/secrets-service-yavar:latest', status: 'Running', ready: '1/1'},
                    {name: 'tox-service-yavar-deployment', image: 'zinfradevv1.azurecr.io/zgrid-tox:latest', status: 'Running', ready: '1/1'},
                    {name: 'gibberish-service-yavar-deployment', image: 'zinfradevv1.azurecr.io/gibberish-service:latest', status: 'Running', ready: '1/1'},
                    {name: 'simple-format-service-deployment', image: 'zinfradevv1.azurecr.io/simple-format-service:latest', status: 'Running', ready: '1/1'},
                    {name: 'cors-proxy-service', image: 'zinfradevv1.azurecr.io/cors-proxy-service:latest', status: 'Running', ready: '1/1'},
                    {name: 'api-redirect-service', image: 'nginx:alpine', status: 'Running', ready: '1/1'},
                    {name: 'zgrid-release-zgrid-chart-ban', image: 'zinfradevv1.azurecr.io/ban-service:latest', status: 'Running', ready: '1/1'}
                ];

                function renderServices() {
                    const serviceList = document.getElementById('service-list');
                    serviceList.innerHTML = services.map(service => `
                        <div class="service-item">
                            <div class="service-info">
                                <h3>${service.name}</h3>
                                <p>${service.image}</p>
                            </div>
                            <div class="service-status">
                                <div class="status-badge">${service.status}</div>
                                <small style="display: block; margin-top: 0.25rem; color: var(--color-secondary);">${service.ready}</small>
                            </div>
                        </div>
                    `).join('');
                }

                function refreshData() {
                    document.getElementById('timestamp').textContent = new Date().toLocaleString();
                    renderServices();
                }

                // Auto-refresh every 30 seconds
                setInterval(refreshData, 30000);

                // Initial render
                renderServices();
            </script>
        </body>
        </html>
        '''
        return html_content

    @app.route('/api/dashboard')
    def api_dashboard():
        """API endpoint for dashboard data"""
        return jsonify({
            'timestamp': datetime.now().isoformat(),
            'namespace': 'z-grid',
            'status': 'operational',
            'services': 13,
            'uptime': '100%',
            'avg_response': '1.2s',
            'success_rate': '99.9%'
        })

    @app.route('/api/health')
    def api_health():
        """Health check endpoint"""
        return jsonify({
            'status': 'healthy',
            'namespace': 'z-grid',
            'timestamp': datetime.now().isoformat(),
            'version': '2.0.0'
        })

    if __name__ == '__main__':
        port = int(os.environ.get('PORT', 5000))
        print(f"Starting Z-Grid Enhanced Monitoring Dashboard on port {port}")
        print(f"Monitoring namespace: z-grid")
        app.run(host='0.0.0.0', port=port, debug=False)

  requirements.txt: |
    Flask==2.3.3

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: emergency-monitoring-dashboard
  namespace: z-grid
  labels:
    app: emergency-monitoring-dashboard
    component: monitoring
spec:
  replicas: 1
  selector:
    matchLabels:
      app: emergency-monitoring-dashboard
  template:
    metadata:
      labels:
        app: emergency-monitoring-dashboard
        component: monitoring
    spec:
      containers:
      - name: monitoring-dashboard
        image: python:3.11-slim
        command: ['sh', '-c']
        args:
        - |
          cd /app
          pip install --no-cache-dir -r requirements.txt
          python app.py
        ports:
        - containerPort: 5000
          name: http
        env:
        - name: NAMESPACE
          value: "z-grid"
        - name: PORT
          value: "5000"
        - name: PYTHONUNBUFFERED
          value: "1"
        resources:
          requests:
            memory: "256Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"
            cpu: "200m"
        livenessProbe:
          httpGet:
            path: /api/health
            port: 5000
          initialDelaySeconds: 15
          periodSeconds: 30
          timeoutSeconds: 10
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /api/health
            port: 5000
          initialDelaySeconds: 5
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        volumeMounts:
        - name: monitoring-config
          mountPath: /app
          readOnly: false
      volumes:
      - name: monitoring-config
        configMap:
          name: emergency-monitoring-config
      restartPolicy: Always

---
apiVersion: v1
kind: Service
metadata:
  name: emergency-monitoring-dashboard-service
  namespace: z-grid
  labels:
    app: emergency-monitoring-dashboard
    component: monitoring
spec:
  selector:
    app: emergency-monitoring-dashboard
  ports:
  - name: http
    port: 5000
    targetPort: 5000
    protocol: TCP
  type: ClusterIP